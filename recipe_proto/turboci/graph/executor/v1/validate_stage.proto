// Copyright 2025 The Chromium Authors
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

syntax = "proto3";

package turboci.graph.executor.v1;

import "turboci/graph/orchestrator/v1/stage.proto";
import "turboci/graph/orchestrator/v1/stage_execution_policy.proto";
import "turboci/graph/orchestrator/v1/value_data.proto";

option go_package = "go.chromium.org/turboci/proto/go/graph/executor/v1;executorpb";
option java_multiple_files = true;

// Request to validate a stage before it is inserted into the graph.
message ValidateStageRequest {
  // Stage to validate.
  optional orchestrator.v1.Stage stage = 1;

  // A map containing [ValueData] for `stage`.
  //
  // This is key'd by [ValueRef].digest.
  map<string, orchestrator.v1.ValueData> value_data = 4;
}

// Response to a stage validation request.
message ValidateStageResponse {
  // Validated execution policy for the stage.
  //
  // It SHOULD be based on `stage.execution_policy.requested`. In particular
  // executors are expected to populate various unset fields with
  // executor-specific defaults (see e.g. `timeout` field in
  // StageAttemptExecutionPolicy).
  //
  // Required.
  optional orchestrator.v1.StageExecutionPolicy stage_execution_policy = 1;
}
