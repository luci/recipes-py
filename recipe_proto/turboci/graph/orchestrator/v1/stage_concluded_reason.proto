// Copyright 2025 The Chromium Authors
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

syntax = "proto3";

package turboci.graph.orchestrator.v1;

option go_package = "go.chromium.org/turboci/proto/go/graph/orchestrator/v1;orchestratorpb";
option java_multiple_files = true;

// Describes why a stage is not in PLANNED or ATTEMPTING state anymore.
//
// Set for stages that are in AWAITING_GROUP or FINAL states.
enum StageConcludedReason {
  // UNKNOWN means the stage is not concluded yet.
  STAGE_CONCLUDED_REASON_UNKNOWN = 0;

  // The last attempt to run the stage finished in STAGE_ATTEMPT_STATE_COMPLETE
  // state.
  STAGE_CONCLUDED_REASON_ATTEMPT_COMPLETE = 1;

  // The last attempt to run the stage finished in STAGE_ATTEMPT_STATE_INCOMPLETE
  // state and the stage reached max allowed number of attempt retries.
  STAGE_CONCLUDED_REASON_NO_RETRIES_LEFT = 2;

  // The last attempt to run the stage finished in STAGE_ATTEMPT_STATE_INCOMPLETE
  // state and the executor indicated that there should be no retry.
  STAGE_CONCLUDED_REASON_FINAL_ATTEMPT_BLOCKED_RETRY = 3;

  // There's no time left to run an attempt per `stage_timeout` in
  // StageExecutionPolicy.
  //
  // Can either happen after retrying an incomplete attempt or before the first
  // attempt (if the stage was in PLANNING state for too long).
  //
  // See StageExecutionPolicy for details.
  STAGE_CONCLUDED_REASON_TIMEOUT = 4;

  // The Stage was explicitly cancelled via WriteNodes.
  STAGE_CONCLUDED_REASON_CANCELLED = 5;
}
