// Copyright 2026 The Chromium Authors
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

syntax = "proto3";

package turboci.graph.orchestrator.v1;

import "turboci/graph/orchestrator/v1/type_set.proto";

option go_package = "go.chromium.org/turboci/proto/go/graph/orchestrator/v1;orchestratorpb";
option java_multiple_files = true;

// TypeInfo lets the orchestrator know which type(s) the caller wants to see
// embedded in Value messages within API responses.
message TypeInfo {
  // Set of type URLs that the caller wants to see in Value messages in the
  // response. Any Value message whose type URL is not specified here will be
  // omitted in the response.
  //
  // In many cases, there will be a single Value per Node and the two are
  // integrally linked (e.g. a Check Option has only one Datum, and the Check
  // Option has little value without its Datum) and in those cases the
  // containing Node will be omitted if the Value message is filtered. In other
  // cases where the containing Node has multiple Values and/or has value
  // without the Values, the containing Node will be included in the response
  // even if all its Values are omitted, and it may contain an incomplete set of
  // Values if some are filtered.
  //
  // The set may contain an URL with a trailing wildcard to indicate that you
  // want all data whose type appears in this proto namespace. For example:
  //   * type.googleapis.com/turboci.data.*
  //   * type.googleapis.com/*
  //
  // Use this power wisely! This can have the following adverse affects:
  //   * It can send your client much more data than it needs (and the server
  //     will do more work to obtain and serialize this useless data).
  //   * It can make coupling analysis harder; if all nodes are reading all
  //     data, then it makes it much harder to answer "who depends on this
  //     data type?"
  //
  // Good usages of this (especially the full wildcard, "type.googleapis.com/*")
  // include:
  //   * Humans trying to debug/observe data in the graph (via UI or CLI).
  //   * LLMs trying to analyze data in the graph.
  optional TypeSet wanted = 1;

  // If specified the orchestrator will encode all Values with this
  // alternate encoding, excluding types matching patterns in `known`.
  //
  // Note that the orchestrator may have an out-of-date version of the
  // descriptors - if this happens then Value.has_unknown_fields may be set
  // to `true`.
  //
  // This is intended to support:
  //   * Humans trying to debug/observe data in the graph (via UI or CLI).
  //   * LLMs trying to analyze data in the graph.
  //
  // Stage implementations, monitoring pipelines and scripts should ideally
  // be written to directly use the original binary encoded proto data
  // instead of relying on this mechanism.
  optional bool unknown_jsonpb = 2;

  // Set of type URLs that the caller has descriptors for and therefore does
  // not need to be encoded in the response, if `unknown_jsonpb` is specified.
  // Applied only to message types embedded into Value messages.
  optional TypeSet known = 3;
}
